---
import { Icon } from "astro-icon/components";
import { formatDate } from "../lib/helpers";
import BasicLayout from "./BasicLayout.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

type Props = {
  title: string;
  description: string;
  pubDate: Date;
  minutesRead: string;
  url: string;
  image?: ImageMetadata;
  imageAlt?: string;
};

const { title, description, pubDate, minutesRead, url, image, imageAlt } =
  Astro.props;

// Build absolute OG image URL if hero image exists
const ogImage = image ? `${Astro.url.origin}${image.src}` : undefined;
---

<script>
  import { stagger, animate, type AnimationSequence } from "motion";
  import { loaderAnimation } from "../lib/constants";

  const animateItems = document.querySelectorAll(
    ".blog-detail-content > *:not(.back-btn)",
  );

  const sequence = [
    loaderAnimation,
    [
      animateItems,
      { y: ["40%", "0%"], opacity: [0, 1] },
      {
        type: "spring",
        at: "-0.5",
        delay: stagger(0.1),
      },
    ],
  ];

  animate(sequence as AnimationSequence);
</script>

<BasicLayout
  description={description}
  page="blog"
  slug={url}
  title={title}
  ogImage={ogImage}
>
  <main
    class="blog-detail-content mx-auto max-w-3xl w-full min-h-screen p-4 md:p-8 pt-32 pb-20 text-neutral-100"
  >
    <a
      href="/blog"
      class="flex items-center gap-2 w-fit text-white bg-neutral-900 hover:bg-neutral-800 px-4 py-2 border-1 border-solid border-neutral-600 rounded-lg fixed top-10 left-10 z-50 back-btn"
    >
      <Icon name="ri:arrow-left-line" class="w-4 h-4" />Back to Posts
    </a>
    <div class="my-10">
      <h1 class="text-5xl font-semibold">{title}</h1>
      <div class="flex justify-between pt-4 text-gray-500 text-sm">
        <p>{formatDate(pubDate)}</p>
        <p>{minutesRead}</p>
      </div>
    </div>
    {
      image && (
        <div class="hero-image-wrapper">
          <Image
            src={image}
            alt={imageAlt ?? title}
            quality="high"
            class="hero-image"
          />
        </div>
      )
    }
    <article class="blog-content">
      <slot />
    </article>

    <!-- Bento-style Footer Card -->
    <div
      class="mt-12 p-6 bg-darkslate-500 rounded-lg border border-darkslate-400"
    >
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
      >
        <div>
          <p class="text-sm font-medium text-neutral-100">
            Written by Sodiq Ardianto
          </p>
          <p class="text-xs text-neutral-400 mt-1">
            {formatDate(pubDate)} · {minutesRead}
          </p>
        </div>
        <a
          href="/blog"
          class="text-sm text-primary-400 hover:text-primary-300 transition-colors flex items-center gap-1"
        >
          <span>←</span>
          <span>Back to all posts</span>
        </a>
      </div>
    </div>
  </main>
</BasicLayout>
