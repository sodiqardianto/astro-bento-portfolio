---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card/index.astro";
import IntroCard from "../components/IntroCard.astro";
import ContactsCard from "../components/ContactsCard.astro";
import ThemeChangeCard from "../components/ThemeChangeCard.astro";
import TimeZone from "../components/TimeZoneCard.astro";
import AboutMe from "../components/AboutMe.astro";
import Now from "../components/Now.astro";

const posts = (await getCollection("blog"))
  ?.sort(
    (blogEntryA, blogEntryB) =>
      (blogEntryB.data.pubDate || new Date()).getTime() -
      (blogEntryA.data.pubDate || new Date()).getTime(),
  )
  .slice(0, 4);

const projects = (await getCollection("portfolio"))
  ?.sort((a, b) => parseInt(b.data.year) - parseInt(a.data.year))
  .slice(0, 3);
---

<script>
  import { stagger, animate, type AnimationSequence } from "motion";
  import { loaderAnimation } from "../lib/constants";
  const cards = document.querySelectorAll(".card");

  const sequence = [
    loaderAnimation,
    [
      cards,
      { y: ["40%", "0%"], opacity: [0, 1] },
      {
        type: "spring",
        at: "-0.1",
        delay: stagger(0.2),
      },
    ],
  ];

  animate(sequence as AnimationSequence);
</script>

<Layout
  description="I'm a fullstack developer based in Jakarta, Indonesia, with a strong backend foundation using Laravel, and a growing focus on frontend technologies like React and Astro. Passionate about building elegant, scalable solutions for the web."
  title="Sodiq Ardianto – Fullstack Developer"
>
  <main
    class="text-white m-auto p-2 grid gap-2 max-w-6xl overflow-hidden relative w-full sm:p-4 sm:gap-2 md:grid-cols-2 md:gap-3 md:p-6 lg:h-screen lg:grid-rows-8 lg:grid-cols-4 lg:gap-4 lg:max-h-[800px]"
  >
    <IntroCard />
    <AboutMe />
    <ContactsCard />
    <TimeZone />
    <Now />
    <Card
      href="/blog"
      colSpan="md:col-span-1"
      rowSpan="md:row-span-3"
      title="Blog"
    >
      <div
        class="mt-4 flex flex-col gap-3 overflow-y-auto max-h-[calc(100%-3rem)] pr-1 custom-scrollbar"
      >
        {
          posts?.map((post) => (
            <a
              href={`/blog/${post.id}`}
              class="group/post flex flex-col gap-1 p-2 rounded-lg hover:bg-darkslate-400 transition-colors"
            >
              <h3 class="text-sm font-medium text-neutral-100 group-hover/post:text-primary-400 line-clamp-2">
                {post.data.title}
              </h3>
              <p class="text-xs text-neutral-400">
                {post.data.pubDate?.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
              </p>
            </a>
          ))
        }
      </div>
    </Card>
    <Card
      href="/portfolio"
      colSpan="md:col-span-1"
      rowSpan="md:row-span-2"
      title="Portfolio"
    >
      <div
        class="mt-4 flex flex-col gap-3 overflow-y-auto max-h-[calc(100%-3rem)] pr-1 custom-scrollbar"
      >
        {
          projects?.map((project) => (
            <a
              href={`/portfolio/${project.id}`}
              class="group/project flex flex-col gap-1 p-2 rounded-lg hover:bg-darkslate-400 transition-colors"
            >
              <h3 class="text-sm font-medium text-neutral-100 group-hover/project:text-primary-400">
                {project.data.title}
              </h3>
              <p class="text-xs text-neutral-400">
                {project.data.tags.slice(0, 3).join(" · ")}
              </p>
            </a>
          ))
        }
      </div>
    </Card>
    <ThemeChangeCard />
    <Card colSpan="md:col-span-1" rowSpan="md:row-span-1">
      <p class="text-xs footer-text">
        © {new Date().getFullYear()} · Crafted with ♥️ using <a
          class="text-red-500"
          href="https://astro.build/"
          target="_blank">Astro</a
        > by Sodiq Ardianto
      </p>
    </Card>
  </main>
</Layout>

<style>
  /* Make footer text black in dark mode (default state) */
  .footer-text {
    color: #ffffff !important;
  }

  /* Make footer text white in light mode */
  :global(.light-mode) .footer-text {
    color: #000000 !important;
  }

  /* Ensure bold text maintains proper contrast */
  .footer-text b {
    color: inherit;
  }

  /* Blog list in card - dark mode (default) */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Light mode styles for blog list */
  :global(.light-mode) .group-hover\\/post:hover,
  :global(.light-mode) .group-hover\\/project:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  /* Custom scrollbar for blog list - dark mode */
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: var(--darkslate-400);
    border-radius: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: var(--darkslate-300);
  }

  /* Custom scrollbar - light mode */
  :global(.light-mode) .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #c9c9c9;
  }

  :global(.light-mode) .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #a0a0a0;
  }
</style>
